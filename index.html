<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’Š ××™×ª×•×¨ ×¨×•×‘×¨×™×§×•×ª - Pitronic Studio</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    <link rel="icon" type="image/png" href="icon.png">
    
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f8fafc;
            --border: #e2e8f0;
            --text: #1e293b;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px 20px 60px 20px;
            color: var(--text);
        }

        .container {
            max-width: 1300px;
            margin: auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        header { 
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 25px; 
            border-bottom: 2px solid var(--border); 
            padding-bottom: 15px; 
        }
        
        .header-top {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .header-logo { width: 50px; height: 50px; object-fit: contain; }
        h1 { color: var(--primary); margin: 0; font-size: 1.8rem; }
        .credit-line { color: #64748b; font-size: 0.95rem; margin: 5px 0; }

        .filter-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        select, input {
            width: 100%;
            padding: 12px;
            font-size: 15px;
            border: 1px solid var(--border);
            border-radius: 10px;
            outline: none;
            transition: 0.2s;
        }

        select:focus, input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 15px; border: 1px solid var(--border); border-radius: 10px; }
        th { background: #f1f5f9; color: var(--primary); padding: 15px; text-align: right; font-size: 0.95rem; border-bottom: 2px solid var(--border); border-left: 1px solid var(--border); }
        td { padding: 12px 15px; border-bottom: 1px solid var(--border); border-left: 1px solid var(--border); vertical-align: middle; }
        th:last-child, td:last-child { border-left: none; }

        td:nth-child(1) { background-color: #ffffff; }
        td:nth-child(2) { background-color: #fcfcfc; }
        td:nth-child(3) { background-color: #f8fafc; font-family: 'Verdana', sans-serif; font-size: 0.85rem; }
        td:nth-child(4) { background-color: #f1f5f9; font-weight: bold; }

        .ltr { direction: ltr; text-align: left; }

        .remedy-abbr {
            cursor: help;
            border-bottom: 1px dotted var(--accent);
            color: var(--primary);
            position: relative;
            display: inline-block;
        }

        .remedy-abbr:hover::after {
            content: attr(data-full);
            position: absolute;
            bottom: 130%;
            left: 0;
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .note-tag {
            display: inline-flex;
            align-items: center;
            background: #e2e8f0;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 3px;
        }

        .note-emoji { margin-left: 6px; font-size: 1.1rem; }

        .copy-btn {
            background: white; border: 1px solid #cbd5e1; padding: 5px 10px; border-radius: 6px; cursor: pointer; font-size: 14px; margin-right: 10px; float: right;
        }

        footer { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px; text-align: center; border-top: 1px solid var(--border); font-size: 0.75rem; color: #64748b; }

        @media screen and (max-width: 768px) {
            .filter-area { grid-template-columns: 1fr; }
            table, thead, tbody, th, td, tr { display: block; }
            td { border: none; border-bottom: 1px solid var(--border); padding-right: 40% !important; text-align: left !important; position: relative; display: flex; align-items: center; justify-content: flex-end; min-height: 45px;}
            td:before { position: absolute; right: 10px; font-weight: bold; content: attr(data-label); }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-top">
            <img src="icon.png" alt="Logo" class="header-logo">
            <h1>××™×ª×•×¨ ×¨×•×‘×¨×™×§×•×ª ××ª×§×“×</h1>
        </div>
        <p class="credit-line">××‘×•×¡×¡ ×¢×œ ××¡×“ ×”× ×ª×•× ×™× ×©×œ ×¢×˜×¨×” ×–×™×™×“××Ÿ</p>
        <p id="rubricCount" style="color: #94a3b8; font-size: 0.8rem; margin: 0;"></p>
    </header>

    <div class="filter-area">
        <select id="typeFilter" onchange="filterTable()"><option value="">ğŸŒŸ ×›×œ ×”×§×˜×’×•×¨×™×•×ª</option></select>
        <select id="remedyFilter" onchange="filterTable()"><option value="">ğŸ§ª ×›×œ ×”×¨××“×™×¡</option></select>
    </div>

    <input type="text" id="searchInput" placeholder="×—×™×¤×•×© ×—×•×¤×©×™ (×¢×‘×¨×™×ª / ×× ×’×œ×™×ª)..." onkeyup="filterTable()">

    <table id="mainTable">
        <thead>
            <tr>
                <th style="width: 25%;">×”×¢×¨×•×ª ×•×¡×™×•×•×’</th>
                <th style="width: 30%;">×ª×¨×’×•× ×œ×¢×‘×¨×™×ª</th>
                <th class="ltr" style="width: 30%;">English Rubric</th>
                <th class="ltr" style="width: 15%;">Remedy</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<footer>× ×•×¦×¨ ×¢"×™ <span style="font-weight:bold">Pitronic Studio</span> Â© 2026</footer>

<script>
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vT_3Yju4wccOqBM5OohlEbiY5XA2Vz_3uHGfz_Qn54fbyTkYTkgX95Fy7BFuP7cZFc_vgmzOEHBwCbs/pub?output=csv';
    let rubricData = [];

    const emojiMap = {
        'mind': 'ğŸ§ ', 'head': 'ğŸ‘¤', 'eye': 'ğŸ‘ï¸', 'ear': 'ğŸ‘‚', 'nose': 'ğŸ‘ƒ', 'throat': 'ğŸ§£',
        'stomach': 'ğŸ¤¢', 'abdomen': 'ğŸ¡', 'chest': 'ğŸ«', 'back': 'ğŸ¦´', 'extremities': 'ğŸ¦µ',
        'sleep': 'ğŸ˜´', 'fever': 'ğŸ¤’', 'skin': 'âœ‹', 'general': 'ğŸŒ',
        '×”×—××¨×”': 'ğŸ“‰', '×”×˜×‘×”': 'ğŸ“ˆ', '×œ×™×œ×”': 'ğŸŒ™', '×‘×•×§×¨': 'ğŸŒ…', '×¢×¨×‘': 'ğŸŒ†', '×¦×”×¨×™×™×': 'â˜€ï¸'
    };

    function getTypeEmoji(type) {
        const t = (type || "").toLowerCase();
        for (let key in emojiMap) { if (t.includes(key)) return emojiMap[key]; }
        return 'ğŸ“Œ';
    }

    function getRemedyEmoji(name) {
        const n = (name || "").toLowerCase();
        const specificEmojis = { 'apis': 'ğŸ', 'arn': 'ğŸ©¹', 'acon': 'â„ï¸', 'ars': 'ğŸ§ª', 'bell': 'ğŸ”´', 'bry': 'ğŸŒµ', 'calc': 'ğŸš', 'phos': 'ğŸ’¡', 'puls': 'ğŸŒ¸', 'sep': 'ğŸ¦‘', 'sil': 'â³', 'staph': 'ğŸ—¡ï¸', 'sul': 'ğŸŒ‹', 'lach': 'ğŸ', 'lyc': 'ğŸ¥¦', 'nat': 'ğŸ§‚', 'nux': 'ğŸªµ' };
        for (let key in specificEmojis) { if (n.includes(key)) return specificEmojis[key]; }
        return 'ğŸ’Š';
    }

    function getAbbr(fullName) {
        if (!fullName) return "";
        const parts = fullName.split(/[- ]/);
        let abbr = parts[0].substring(0, 4);
        if (parts.length > 1) abbr += ". " + parts[1].substring(0, 2);
        return abbr.charAt(0).toUpperCase() + abbr.slice(1).toLowerCase();
    }

    function formatNotes(notes) {
        if (!notes) return "";
        return notes.split('|').map(n => {
            const clean = n.trim();
            if (!clean) return "";
            return `<span class="note-tag"><span class="note-emoji">${getTypeEmoji(clean)}</span>${clean}</span>`;
        }).join('');
    }

    async function copyText(text, btn) {
        await navigator.clipboard.writeText(text);
        const old = btn.innerHTML;
        btn.innerHTML = 'âœ…';
        setTimeout(() => btn.innerHTML = old, 1500);
    }

    async function fetchData() {
        try {
            const res = await fetch(SHEET_URL);
            const csv = await res.text();
            const rows = csv.split('\n').slice(1);
            rubricData = rows.map(row => {
                const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    remedy: (cols[0] || "").replace(/"/g, '').trim(),
                    eng: (cols[1] || "").replace(/"/g, '').trim(),
                    heb: (cols[2] || "").replace(/"/g, '').trim(),
                    notes: (cols[3] || "").replace(/"/g, '').trim()
                };
            }).filter(r => r.remedy || r.eng);
            document.getElementById('rubricCount').innerText = `× ×˜×¢× ×• ${rubricData.length} ×¨×•×‘×¨×™×§×•×ª`;
            populateFilters();
            filterTable();
        } catch (e) { console.error(e); }
    }

    function populateFilters() {
        const rSel = document.getElementById('remedyFilter');
        const remedies = [...new Set(rubricData.map(i => i.remedy))].sort();
        remedies.forEach(r => { if(r) rSel.innerHTML += `<option value="${r}">${getRemedyEmoji(r)} ${r}</option>`; });
        
        const tSel = document.getElementById('typeFilter');
        const categories = ['Mind', 'Head', 'Eye', 'Ear', 'Nose', 'Throat', 'Stomach', 'Abdomen', 'Chest', 'Back', 'Extremities', 'Sleep', 'Fever', 'Skin', 'General'];
        categories.forEach(t => { tSel.innerHTML += `<option value="${t}">${getTypeEmoji(t)} ${t}</option>`; });
    }

    function filterTable() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const rF = document.getElementById('remedyFilter').value;
        const tF = document.getElementById('typeFilter').value.toLowerCase();

        const filtered = rubricData.filter(i => {
            const mQ = i.remedy.toLowerCase().includes(q) || i.eng.toLowerCase().includes(q) || i.heb.toLowerCase().includes(q);
            const mR = !rF || i.remedy === rF;
            const mT = !tF || i.notes.toLowerCase().includes(tF) || i.eng.toLowerCase().includes(tF);
            return mQ && mR && mT;
        });

        const body = document.getElementById('tableBody');
        body.innerHTML = filtered.map(i => `
            <tr>
                <td data-label="×”×¢×¨×•×ª">${formatNotes(i.notes)}</td>
                <td data-label="×ª×¨×’×•×">${i.heb}</td>
                <td data-label="English" class="ltr">
                    <button class="copy-btn" onclick="copyText('${i.eng.replace(/'/g,"\\'")}', this)">ğŸ“‹</button>
                    ${i.eng}
                </td>
                <td data-label="Remedy" class="ltr">
                    ${getRemedyEmoji(i.remedy)} <span class="remedy-abbr" data-full="${i.remedy}">${getAbbr(i.remedy)}</span>
                </td>
            </tr>
        `).join('');
    }
    fetchData();
</script>
</body>
</html>
